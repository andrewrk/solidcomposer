<% if (versions.length) { %>
    <div id="next-version" class="version">
        <% if (project.checked_out_to !== null) { %>
            <% var version_user = project.checked_out_to; %>
            {% include 'workbench/version_owner.jst.html' %}
        <% } else { %>
            <% var version_user = user; %>
            {% include 'workbench/version_owner.jst.html' %}
        <% } %>
        <div id="status">
            <% if (project.checked_out_to === user.id) { %>
                Checked out to <strong>you</strong>.
            <% } else if (project.checked_out_to !== null) { %>
                Checked out.
            <% } else { %>
                Available.
            <% } %>
        </div>
        <div id="action">
            <% if (project.checked_out_to === user.id) { %>
                Check in.
            <% } else if (project.checked_out_to !== null) { %>
                Poke them.
            <% } else { %>
                Check out.
            <% } %>
        </div>
    </div>
    <% for (var i=versions.length-1; i>=0; --i) { var version = versions[i]; %>
        <div id="version-<%=i%>" class="version">
            <% var version_user = version.song.owner; %>
            {% include 'workbench/version_owner.jst.html' %}
            <div class="version-data">
                <a name="version<%=version.version%>"></a>
                Version <%=version.version%> on <%=Time.formatDateTime(Time.localTime(version.song.date_added))%>
            </div>
            <% var song = version.song; song.band = project.band; %>
            {% include 'player/player.jst.html' %}
            <% if (! version.song.mp3_file) { %>
                <div id="missing-mp3-<%=i%>" class="missing-thing">
                    <h2><a href="#">Missing MP3 File</a></h2>
                    <div class="missing-mp3-form">
                        <form id="missing-mp3-upload-<%=i%>" method="post" enctype="multipart/form-data" action="{% url workbench.ajax_provide_mp3 %}">
                            <% var upload_caption = "MP3 file"; %>
                            {% include 'workbench/missing_file_form.jst.html' %}
                        </form>
                    </div>
                </div>
            <% } %>
            <% if (! version.song.source_file) { %>
                <div id="missing-project-<%=i%>" class="missing-thing">
                    <h2><a href="#">Missing Project File</a></h2>
                    <div class="missing-project-form">
                        <form id="missing-project-upload-<%=i%>" method="post" enctype="multipart/form-data" action="{% url workbench.ajax_provide_project %}">
                            <% var upload_caption = "Project file"; %>
                            {% include 'workbench/missing_file_form.jst.html' %}
                        </form>
                    </div>
                </div>
            <% } %>
            <% if (version.song.anyMissingSamples) { %>
                <div id="missing-samples-<%=i%>" class="missing-thing">
                    <h2><a href="#">Missing Samples</a></h2>
                    <div class="missing-list">
                        <ul>
                            <% for (var sampleIndex=0; sampleIndex<version.song.samples.length; ++sampleIndex) {
                               var sample = version.song.samples[sampleIndex]; %>
                                <% if (sample.missing) { %>
                                    <li>
                                        <%= sample.title %>
                                    </li>
                                <% } %>
                            <% } %>
                        </ul>
                    </div>
                    <p>Upload them here. Feel free to use a .zip file.</p>
                    <div class="missing-samples-form">
                        <form id="missing-samples-upload-<%=i%>" method="post" enctype="multipart/form-data" action="{% url workbench.ajax_upload_samples %}">
                            <fieldset>
                                <input type="hidden" name="version" value="<%=version.id%>" />
                                <table>
                                    {% include 'workbench/sample_upload_row.jst.html' %}
                                    <tr>
                                        <td>
                                            <a href="#" id="add-file-<%=i%>">Add another</a>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                        </td>
                                        <td>
                                            <input type="submit" value="Upload" />
                                        </td>
                                    </tr>
                                </table>
                            </fieldset>
                        </form>
                    </div>
                </div>
            <% } %>
            <% var comment_node = version.song.comment_node; %>
            {% include 'player/normal_comments.jst.html' %}
        </div>
    <% } %>
<% } %>


function CharacterStack(str){this.characters=[];this.peek=function peek(){return this.characters[this.characters.length-1];};this.pop=function pop(){return this.characters.pop();};this.push=function push(c){this.characters.push(c);};this.hasMore=function hasMore(){if(this.characters.length>0){return true;}else{return false;}};for(var i=str.length;i>=0;i=i-1){this.characters.push(str.charAt(i));}}
function StringWriter(){this.str="";this.write=function write(s){this.str+=s;};this.toString=function toString(){return this.str;};}
String.prototype.endsWith=function endsWith(c){if(this.charAt(this.length-1)==c){return true;}else{return false;}};String.prototype.startsWith=function startsWith(c){if(this.charAt(0)==c){return true;}else{return false;}};String.prototype.replaceAll=function replaceAll(a,b){var s=this;while(s.indexOf(a)>-1){s=s.replace(a,b);}
return s;};var Jst={parseScriptlet:function parseScriptlet(stack){var fragment=new StringWriter();while(stack.hasMore()){if(stack.peek()=='%'){var c=stack.pop();if(stack.peek()=='>'){stack.pop();if(stack.peek()=='\n'){fragment.write(stack.pop());}
break;}else{fragment.write(c);}}else{fragment.write(stack.pop());}}
return fragment.toString();},isOpeningDelimiter:function isOpeningDelimiter(c){if(c=="<"||c=="%lt;"){return true;}else{return false;}},isClosingDelimiter:function isClosingDelimiter(c){if(c==">"||c=="%gt;"){return true;}else{return false;}},appendExpressionFragment:function appendExpressionFragment(writer,fragment){if(fragment.startsWith("\"")&&!fragment.endsWith("\"")){if(fragment.endsWith("\n")&&fragment.charAt(fragment.length-2)=='"'){}else{throw{"message":"'"+fragment+"' is not properly quoted"};}}
if(!fragment.startsWith("\"")&&fragment.endsWith("\"")){throw{"message":"'"+fragment+"' is not properly quoted"};}
if(fragment.endsWith("\n")){writer.write("Jst.safeWriteln(");fragment=fragment.substring(0,fragment.length-1);}else{writer.write("Jst.safeWrite(");}
if(fragment.startsWith("\"")&&fragment.endsWith("\"")){fragment=fragment.substring(1,fragment.length-1);writer.write("\"");for(var i=0;i<fragment.length;i=i+1){var c=fragment.charAt(i);if(c=='"'){writer.write("\\");writer.write(c);}}
writer.write("\"");}else{for(var j=0;j<fragment.length;j=j+1){writer.write(fragment.charAt(j));}}
writer.write(");");},appendTextFragment:function appendTextFragment(writer,fragment){if(fragment.endsWith("\n")){writer.write("Jst.writeln(\"");}else{writer.write("Jst.write(\"");}
for(var i=0;i<fragment.length;++i){var c=fragment.charAt(i);if(c=='"'){writer.write("\\");}
if(c!='\n'&&c!='\r'){writer.write(c);}}
writer.write("\");");},parseExpression:function parseExpression(stack){var fragment=new StringWriter();while(stack.hasMore()){if(stack.peek()=='%'){var c=stack.pop();if(Jst.isClosingDelimiter(stack.peek())){stack.pop();if(stack.peek()=='\n'){fragment.write(stack.pop());}
break;}else{fragment.write("%");}}else{fragment.write(stack.pop());}}
return fragment.toString();},parseText:function parseText(stack){var fragment=new StringWriter();while(stack.hasMore()){if(Jst.isOpeningDelimiter(stack.peek())){var c=stack.pop();if(stack.peek()=='%'){stack.push(c);break;}else{fragment.write(c);}}else{var d=stack.pop();fragment.write(d);if(d=='\n'){break;}}}
return fragment.toString();},compile:function compile(src){var stack=new CharacterStack(src);var writer=new StringWriter();var c;var fragment;while(stack.hasMore()){if(Jst.isOpeningDelimiter(stack.peek())){c=stack.pop();if(stack.peek()=='%'){c=stack.pop();if(stack.peek()=="="){stack.pop();fragment=Jst.parseExpression(stack);Jst.appendExpressionFragment(writer,fragment);}else{fragment=Jst.parseScriptlet(stack);writer.write(fragment);}}else{stack.push(c);fragment=Jst.parseText(stack);Jst.appendTextFragment(writer,fragment);}}else{fragment=Jst.parseText(stack);Jst.appendTextFragment(writer,fragment);}}
return writer.toString();},safeWrite:function safeWrite(s){if(Jst.autoescape){s=s.toString();s=s.replaceAll('&','&amp;');s=s.replaceAll('"','&quot;');s=s.replaceAll('<','&lt;');s=s.replaceAll('>','&gt;');}
Jst.html+=s;},safeWriteln:function safeWriteln(s){Jst.safeWrite(s+"\n");},write:function write(s){Jst.html+=s;},writeln:function writeln(s){Jst.write(s+"\n");},evaluateSingleShot:function evaluateSingleShot(src,args){return evaluate(Jst.compile(src),args);},evaluate:function evaluate(script,args){with(args){Jst.html="";Jst.autoescape=true;eval(script);return Jst.html;}},html:"",autoescape:true,};
String.prototype.endsWith=function endsWith(c){if(this.charAt(this.length-1)==c){return true;}else{return false;}};String.prototype.startsWith=function startsWith(c){if(this.charAt(0)==c){return true;}else{return false;}};RegExp.quote=function(str){return str.replace(/([.?*+\^$\[\]\\(){}\-])/g,"\\$1");};String.prototype.replaceAll=function replaceAll(a,b){return this.replace(new RegExp(RegExp.quote(a),'g'),b);};var Jst=function(){var that;var html="";function CharacterStack(str){var i;this.characters=[];this.peek=function peek(){return this.characters[this.characters.length-1];};this.pop=function pop(){return this.characters.pop();};this.push=function push(c){this.characters.push(c);};this.hasMore=function hasMore(){if(this.characters.length>0){return true;}else{return false;}};for(i=str.length;i>=0;i-=1){this.characters.push(str.charAt(i));}}
function StringWriter(){this.str="";this.write=function write(s){this.str+=s;};this.toString=function toString(){return this.str;};}
function parseScriptlet(stack){var fragment=new StringWriter();var c;while(stack.hasMore()){if(stack.peek()=='%'){c=stack.pop();if(stack.peek()=='>'){stack.pop();if(stack.peek()=='\n'){fragment.write(stack.pop());}
break;}else{fragment.write(c);}}else{fragment.write(stack.pop());}}
return fragment.toString();}
function isOpeningDelimiter(c){if(c=="<"||c=="%lt;"){return true;}else{return false;}}
function isClosingDelimiter(c){if(c==">"||c=="%gt;"){return true;}else{return false;}}
function appendExpressionFragment(writer,fragment,jstWriter){var i,j;var c;if(fragment.startsWith("\"")&&!fragment.endsWith("\"")){if(fragment.endsWith("\n")&&fragment.charAt(fragment.length-2)=='"'){}else{throw{"message":"'"+fragment+"' is not properly quoted"};}}
if(!fragment.startsWith("\"")&&fragment.endsWith("\"")){throw{"message":"'"+fragment+"' is not properly quoted"};}
if(fragment.endsWith("\n")){writer.write(jstWriter+"ln(");fragment=fragment.substring(0,fragment.length-1);}else{writer.write(jstWriter+"(");}
if(fragment.startsWith("\"")&&fragment.endsWith("\"")){fragment=fragment.substring(1,fragment.length-1);writer.write("\"");for(i=0;i<fragment.length;i+=1){c=fragment.charAt(i);if(c=='"'){writer.write("\\");writer.write(c);}}
writer.write("\"");}else{for(j=0;j<fragment.length;j+=1){writer.write(fragment.charAt(j));}}
writer.write(");");}
function appendTextFragment(writer,fragment){var i;var c;if(fragment.endsWith("\n")){writer.write("writeln(\"");}else{writer.write("write(\"");}
for(i=0;i<fragment.length;i+=1){c=fragment.charAt(i);if(c=='"'){writer.write("\\");}
if(c!='\n'&&c!='\r'){writer.write(c);}}
writer.write("\");");}
function parseExpression(stack){var fragment=new StringWriter();var c;while(stack.hasMore()){if(stack.peek()=='%'){c=stack.pop();if(isClosingDelimiter(stack.peek())){stack.pop();if(stack.peek()=='\n'){fragment.write(stack.pop());}
break;}else{fragment.write("%");}}else{fragment.write(stack.pop());}}
return fragment.toString();}
function parseText(stack){var fragment=new StringWriter();var c,d;while(stack.hasMore()){if(isOpeningDelimiter(stack.peek())){c=stack.pop();if(stack.peek()=='%'){stack.push(c);break;}else{fragment.write(c);}}else{d=stack.pop();fragment.write(d);if(d=='\n'){break;}}}
return fragment.toString();}
function safeWrite(s){s=s.toString();s=s.replaceAll('&','&');s=s.replaceAll('"','"');s=s.replaceAll('<','<');s=s.replaceAll('>','>');html+=s;}
function safeWriteln(s){safeWrite(s+"\n");}
function write(s){html+=s;}
function writeln(s){write(s+"\n");}
that={compile:function(src){var stack=new CharacterStack(src);var writer=new StringWriter();var c;var fragment;while(stack.hasMore()){if(isOpeningDelimiter(stack.peek())){c=stack.pop();if(stack.peek()=='%'){c=stack.pop();if(stack.peek()=="="){stack.pop();fragment=parseExpression(stack);appendExpressionFragment(writer,fragment,"safeWrite");}else if(stack.peek()=="+"){stack.pop();fragment=parseExpression(stack);appendExpressionFragment(writer,fragment,"write");}else{fragment=parseScriptlet(stack);writer.write(fragment);}}else{stack.push(c);fragment=parseText(stack);appendTextFragment(writer,fragment);}}else{fragment=parseText(stack);appendTextFragment(writer,fragment);}}
return writer.toString();},evaluate:function(script,args){with(args){html="";eval(script);return html;}},evaluateSingleShot:function(src,args){return this.evaluate(this.compile(src),args);}};return that;}();
